<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/base}">
<head>
    <title>Calendario de Matches</title>
    <style>
        .calendar-container {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .calendar-header {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            padding: 20px;
            border-radius: 10px 10px 0 0;
        }
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background: #e9ecef;
            padding: 1px;
        }
        .calendar-day {
            background: white;
            min-height: 140px;
            padding: 8px;
            position: relative;
            border: none;
        }
        .calendar-day.other-month {
            background: #f8f9fa;
            color: #6c757d;
        }
        .calendar-day.today {
            background: #e8f5e8;
            border: 2px solid #28a745;
        }
        .day-number {
            font-weight: bold;
            margin-bottom: 5px;
        }
        .match-item {
            font-size: 0.75rem;
            padding: 3px 5px;
            border-radius: 4px;
            margin-bottom: 3px;
            cursor: pointer;
            border-left: 3px solid;
        }
        .match-programado { 
            background: #cce5ff; 
            border-left-color: #007bff;
            color: #004085;
        }
        .match-en-curso { 
            background: #fff3cd; 
            border-left-color: #ffc107;
            color: #856404;
        }
        .match-finalizado { 
            background: #d4edda; 
            border-left-color: #28a745;
            color: #155724;
        }
        .match-cancelado { 
            background: #f8d7da; 
            border-left-color: #dc3545;
            color: #721c24;
        }
        .weekday-header {
            background: #495057;
            color: white;
            padding: 12px;
            text-align: center;
            font-weight: bold;
        }
        .match-details {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
    </style>
</head>
<body>
    <div layout:fragment="content">
        <div class="container-fluid">
            <!-- Header -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h1 class="h3 mb-0">Calendario de Matches</h1>
                            <p class="text-muted mb-0">Vista mensual de matches programados</p>
                        </div>
                        <div class="d-flex gap-2">
                            <a th:href="@{/admin/matches/new}" class="btn btn-success">
                                <i class="fas fa-plus me-2"></i>Programar Match
                            </a>
                            <a th:href="@{/admin/matches}" class="btn btn-outline-primary">
                                <i class="fas fa-list me-2"></i>Lista de Matches
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Calendar -->
            <div class="calendar-container">
                <div class="calendar-header">
                    <div class="d-flex justify-content-between align-items-center">
                        <a th:href="@{/admin/matches/calendar(month=${currentDate.minusMonths(1).monthValue}, year=${currentDate.minusMonths(1).year})}" 
                           class="btn btn-light btn-sm">
                            <i class="fas fa-chevron-left"></i>
                        </a>
                        <h3 class="mb-0" th:text="${#temporals.format(currentDate, 'MMMM yyyy')}">
                            Mes Año
                        </h3>
                        <a th:href="@{/admin/matches/calendar(month=${currentDate.plusMonths(1).monthValue}, year=${currentDate.plusMonths(1).year})}" 
                           class="btn btn-light btn-sm">
                            <i class="fas fa-chevron-right"></i>
                        </a>
                    </div>
                </div>

                <!-- Weekday Headers -->
                <div class="calendar-grid">
                    <div class="weekday-header">Domingo</div>
                    <div class="weekday-header">Lunes</div>
                    <div class="weekday-header">Martes</div>
                    <div class="weekday-header">Miércoles</div>
                    <div class="weekday-header">Jueves</div>
                    <div class="weekday-header">Viernes</div>
                    <div class="weekday-header">Sábado</div>

                    <!-- Calendar Days -->
                    <div th:each="day : ${#numbers.sequence(1, 42)}" 
                         th:with="
                            dayDate=${currentDate.withDayOfMonth(1).minusDays(currentDate.withDayOfMonth(1).dayOfWeek.value % 7).plusDays(day - 1)},
                            isCurrentMonth=${dayDate.month == currentDate.month},
                            isToday=${dayDate.equals(T(java.time.LocalDate).now())},
                            dayMatches=${matchesByDate[dayDate.toString()]}"
                         th:class="'calendar-day' + 
                                  (${!isCurrentMonth} ? ' other-month' : '') + 
                                  (${isToday} ? ' today' : '')">
                        
                        <div class="day-number" th:text="${dayDate.dayOfMonth}">1</div>
                        
                        <div th:each="match : ${dayMatches}" 
                             th:class="'match-item match-' + ${match.state.name().toLowerCase().replace('_', '-')}"
                             th:onclick="'window.location.href=\'/admin/matches/' + ${match.id} + '\''"
                             th:title="${match.matchDescription + ' - ' + match.court.name}"
                             data-bs-toggle="tooltip">
                            
                            <div class="fw-bold match-details" 
                                 th:text="${#temporals.format(match.dateHour, 'HH:mm')}">
                                Hora
                            </div>
                            <div class="match-details" th:text="${match.localTeam + ' vs ' + match.visitorTeam}">
                                Equipos
                            </div>
                            <div class="match-details text-muted" th:text="${match.court.name}">
                                Court
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Statistics and Legend -->
            <div class="row mt-4">
                <div class="col-md-8">
                    <div class="card">
                        <div class="card-body">
                            <h6 class="card-title">Leyenda de States</h6>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="d-flex align-items-center mb-2">
                                        <div class="match-item match-programado me-2" style="width: 20px; height: 20px;"></div>
                                        <span>Programado</span>
                                    </div>
                                    <div class="d-flex align-items-center mb-2">
                                        <div class="match-item match-en-curso me-2" style="width: 20px; height: 20px;"></div>
                                        <span>En Curso</span>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="d-flex align-items-center mb-2">
                                        <div class="match-item match-finalizado me-2" style="width: 20px; height: 20px;"></div>
                                        <span>Finalizado</span>
                                    </div>
                                    <div class="d-flex align-items-center mb-2">
                                        <div class="match-item match-cancelado me-2" style="width: 20px; height: 20px;"></div>
                                        <span>Cancelado</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-body">
                            <h6 class="card-title">Resumen del Mes</h6>
                            <div class="d-flex justify-content-between mb-2">
                                <span>Total Matches:</span>
                                <span class="fw-bold" th:text="${#lists.size(matches)}">0</span>
                            </div>
                            <div class="d-flex justify-content-between mb-2">
                                <span>Programados:</span>
                                <span class="text-primary fw-bold" 
                                      th:text="${#lists.size(matches.?[state.name() == 'PROGRAMMED'])}">0</span>
                            </div>
                            <div class="d-flex justify-content-between mb-2">
                                <span>Finalizados:</span>
                                <span class="text-success fw-bold" 
                                      th:text="${#lists.size(matches.?[state.name() == 'FINISHED'])}">0</span>
                            </div>
                            <div class="d-flex justify-content-between">
                                <span>Cancelados:</span>
                                <span class="text-danger fw-bold" 
                                      th:text="${#lists.size(matches.?[state.name() == 'CANCELED'])}">0</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            // Initialize tooltips
            document.addEventListener('DOMContentLoaded', function() {
                var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
                var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
                    return new bootstrap.Tooltip(tooltipTriggerEl);
                });
            });
        </script>
    </div>
</body>
</html>
